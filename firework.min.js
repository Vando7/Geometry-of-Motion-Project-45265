//////////////////////////////////////////////
/// Имена: Иван Михайлов
/// ФН: 45265
/// Специалност: Информатика
/// Прочел съм критерии 44
///

class rocket{
	constructor([x,y,z],[x0,y0,z0],duration){
		this.boom = new particle([x,y,z],[x0,y0,z0],duration,false);
	};

	animate(){
		this.boom.animate();
	};

	isDead(){
		return this.boom.isDead();
	};

	location(){
		return this.boom.location();
	}

	isRocket(){
		return true;
	}

	isExplosion(){
		return false;
	}
}


class explosion{
	constructor([x,y,z]){
		// Тази променлива определя колко частици да има в експлозията.
		this.arrSize = 10;

		this.b=new Array(this.arrSize);
		
		for(var i=0;i<this.arrSize;i++){
			var rand1 = Math.random() / 2;
			var rand2 = 1/2 - rand1;
			var sign1 = Math.floor(Math.random()*2) == 0?-1:1;
			var sign2 = Math.floor(Math.random()*2) == 0?-1:1;
			this.b[i] = new particle([x,y,z],[rand1*sign1,rand2*sign2,Math.random()],Math.random(),false);
		}
	};

	animate(){
		for(var i=0;i<this.arrSize;++i){
			this.b[i].animate();
		}
	};

	isDead(){
		var r = false;
		for(var i=0;i<this.arrSize;++i){
			if(this.b[i].isDead()==false)
				return false;
		}
		return true;
	};

	isRocket(){
		return false;
	}

	isExplosion(){
		return true;
	}
}

// Класа за фойерверки.
class firework{
	constructor([x0,y0,z0],[x,y,z],duration,repeat){
		this.repeat = repeat;
		
		this.r=new rocket([x0,y0,z0],[x,y,z],duration);
		
		this.x0=x0;
		this.y0=y0;
		this.z0=z0;

		this.x = x;
		this.y = y;
		this.z = z;

		this.velocity=[x,y,z];
		this.duration = duration;
		this.isDone = false;
	};

	animate(){
		this.r.animate();
		
		// След като ракетата 'умре', на нейно място се пуска експлозия.
		if(this.r.isDead() && this.r.isRocket()){
			var spawnpoint = this.r.location();
			this.r = new explosion(this.r.location());
		}

		if(this.r.isDead() && this.r.isExplosion()&& this.repeat){
			this.r = new rocket([this.x0,this.y0,this.z0],[this.x,this.y,this.z],this.duration);
			this.isDead= true;
		}

	};
}


class fireworkEmitter{
	constructor([x,y,z],rocketCount){
		this.arrSize = rocketCount;

		this.b=new Array(this.arrSize);
		for(var i=0;i<this.arrSize;i++){
			var rand1 = Math.random() / 5;
			var rand2 = 1/5 - rand1;
			var sign1 = Math.floor(Math.random()*2) == 0?-1:1;
			var sign2 = Math.floor(Math.random()*2) == 0?-1:1;
			this.b[i] = new firework([x,y,z],[rand1*sign1,rand2*sign2,0.5+Math.random()],0.5+Math.random(),true);
		}
	};

	animate(){
		for(var i=0;i<this.arrSize;++i){
			this.b[i].animate();
		}
	}
}